{{- if eq .chezmoi.os "linux" -}}
-- ============================================================================
-- Conky Desktop Widget Configuration (Modern Lua Syntax)
-- ============================================================================
-- Requires: conky 1.10+
-- Documentation: https://conky.cc/config_settings
--
-- Display: Bottom-right desktop widget
-- Theme: Catppuccin Mocha
-- Features: CPU, memory, network, disk, top processes

conky.config = {
    -- ========================================================================
    -- Performance
    -- ========================================================================
    update_interval = 5.0,
    update_interval_on_battery = 60.0,
    total_run_times = 0,
    double_buffer = true,
    cpu_avg_samples = 2,
    net_avg_samples = 2,
    text_buffer_size = 2048,

    -- ========================================================================
    -- Window Settings
    -- ========================================================================
    background = true,
    own_window = true,
    own_window_type = 'desktop',
    own_window_transparent = false,
    own_window_argb_visual = true,
    own_window_argb_value = 230,  -- Slightly transparent
    own_window_hints = 'undecorated,below,sticky,skip_taskbar,skip_pager',

    -- ========================================================================
    -- Position & Size
    -- ========================================================================
    alignment = 'bottom_right',
    gap_x = 20,
    gap_y = 20,
    minimum_width = 300,
    maximum_width = 350,

    -- ========================================================================
    -- Font Settings
    -- ========================================================================
    use_xft = true,
    font = 'FuraCode Nerd Font:size=9',
    override_utf8_locale = true,

    -- ========================================================================
    -- Drawing
    -- ========================================================================
    draw_borders = false,
    draw_outline = false,
    draw_shades = false,
    draw_graph_borders = true,

    -- ========================================================================
    -- Catppuccin Mocha Colors
    -- ========================================================================
    default_color = 'cdd6f4',  -- text
    color0 = '1e1e2e',  -- base (background)
    color1 = '89b4fa',  -- blue (primary)
    color2 = 'a6e3a1',  -- green (success)
    color3 = 'f9e2af',  -- yellow (warning)
    color4 = 'f38ba8',  -- red (critical)
    color5 = 'cba6f7',  -- mauve (accent)
    color6 = 'bac2de',  -- subtext1

    -- ========================================================================
    -- Network Interface (auto-detect primary)
    -- ========================================================================
    -- Uncomment and customize if needed:
    -- template0 = 'wlan0',  -- WiFi interface
    -- template1 = 'eth0',   -- Ethernet interface
}

conky.text = [[
${font FuraCode Nerd Font:size=11}${color1}${nodename}${color}${font}
${color6}${sysname} ${kernel} (${machine})${color}
${if_existing /sys/class/power_supply/BAT0}Battery: ${battery_short} | ${endif}\
Users: ${user_number} | Uptime: ${uptime_short}

${color1}═══ SYSTEM ═══${color}
Processes: ${running_processes} / ${processes}
Threads: ${running_threads} / ${threads}
Load: ${loadavg 1} ${loadavg 2} ${loadavg 3}

${color1}═══ CPU ═══${color}
${if_existing /sys/devices/system/cpu/cpu0}\
CPU 0: ${freq_g cpu0}GHz ${alignr}${cpu cpu0}%
${cpubar cpu0 5}
${endif}\
${if_existing /sys/devices/system/cpu/cpu1}\
CPU 1: ${freq_g cpu1}GHz ${alignr}${cpu cpu1}%
${cpubar cpu1 5}
${endif}\
${if_existing /sys/devices/system/cpu/cpu2}\
CPU 2: ${freq_g cpu2}GHz ${alignr}${cpu cpu2}%
${cpubar cpu2 5}
${endif}\
${if_existing /sys/devices/system/cpu/cpu3}\
CPU 3: ${freq_g cpu3}GHz ${alignr}${cpu cpu3}%
${cpubar cpu3 5}
${endif}\
${if_existing /sys/devices/system/cpu/cpu4}\
CPU 4: ${freq_g cpu4}GHz ${alignr}${cpu cpu4}%
${cpubar cpu4 5}
${endif}\
${if_existing /sys/devices/system/cpu/cpu5}\
CPU 5: ${freq_g cpu5}GHz ${alignr}${cpu cpu5}%
${cpubar cpu5 5}
${endif}\
${if_existing /sys/devices/system/cpu/cpu6}\
CPU 6: ${freq_g cpu6}GHz ${alignr}${cpu cpu6}%
${cpubar cpu6 5}
${endif}\
${if_existing /sys/devices/system/cpu/cpu7}\
CPU 7: ${freq_g cpu7}GHz ${alignr}${cpu cpu7}%
${cpubar cpu7 5}
${endif}

${color1}═══ MEMORY ═══${color}
RAM: ${mem} / ${memmax} ${alignr}${memperc}%
${membar 5}
Swap: ${swap} / ${swapmax} ${alignr}${swapperc}%
${swapbar 5}

${color1}═══ TOP PROCESSES ═══${color}
${color6}By CPU: ${alignr}PID   CPU%  MEM%${color}
${top name 1}${alignr}${top pid 1}  ${top cpu 1}  ${top mem 1}
${top name 2}${alignr}${top pid 2}  ${top cpu 2}  ${top mem 2}
${top name 3}${alignr}${top pid 3}  ${top cpu 3}  ${top mem 3}

${color6}By Memory: ${alignr}PID   CPU%  MEM%${color}
${top_mem name 1}${alignr}${top_mem pid 1}  ${top_mem cpu 1}  ${top_mem mem 1}
${top_mem name 2}${alignr}${top_mem pid 2}  ${top_mem cpu 2}  ${top_mem mem 2}
${top_mem name 3}${alignr}${top_mem pid 3}  ${top_mem cpu 3}  ${top_mem mem 3}

${color1}═══ DISK ═══${color}
Root: ${fs_free /} / ${fs_size /} ${alignr}${fs_used_perc /}%
${fs_bar 5 /}
${if_mounted /home}\
Home: ${fs_free /home} / ${fs_size /home} ${alignr}${fs_used_perc /home}%
${fs_bar 5 /home}
${endif}

${color1}═══ NETWORK ═══${color}
${if_existing /sys/class/net/wlan0}\
WiFi (wlan0): ${addr wlan0}
${if_match "${addr wlan0}" != "No Address"}\
SSID: ${wireless_essid wlan0} ${alignr}Signal: ${wireless_link_qual_perc wlan0}%
Down: ${downspeed wlan0}/s ${alignr}Up: ${upspeed wlan0}/s
${downspeedgraph wlan0 30,140 a6e3a1 a6e3a1} ${alignr}${upspeedgraph wlan0 30,140 f38ba8 f38ba8}
Total: ${totaldown wlan0} ${alignr}Total: ${totalup wlan0}
${endif}
${endif}\
${if_existing /sys/class/net/eth0}\
Ethernet (eth0): ${addr eth0}
${if_match "${addr eth0}" != "No Address"}\
Down: ${downspeed eth0}/s ${alignr}Up: ${upspeed eth0}/s
${downspeedgraph eth0 30,140 a6e3a1 a6e3a1} ${alignr}${upspeedgraph eth0 30,140 f38ba8 f38ba8}
Total: ${totaldown eth0} ${alignr}Total: ${totalup eth0}
${endif}
${endif}\
${if_existing /sys/class/net/enp0s31f6}\
Ethernet (enp0s31f6): ${addr enp0s31f6}
${if_match "${addr enp0s31f6}" != "No Address"}\
Down: ${downspeed enp0s31f6}/s ${alignr}Up: ${upspeed enp0s31f6}/s
Total: ${totaldown enp0s31f6} ${alignr}Total: ${totalup enp0s31f6}
${endif}
${endif}
Public IP: ${execi 3600 curl -s ifconfig.me}

${color1}═══ TIME & DATE ═══${color}
${font FuraCode Nerd Font:size=12}${time %H:%M:%S}${font}
${time %A, %B %d, %Y}
]]
{{- end -}}
